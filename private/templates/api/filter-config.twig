{% header "Content-Type: application/json" %}

var FilterStructure = [

    {% for section in craft.categories.group('filter') %}
    {
        type: 'section',
        label: '{{section.title}}',
        header: true,
        closable: true,
        opened: true,

        fields: [

            {% for field in section.filter.sectionfield %}

            {
                id: '{{ field.fieldSource.first.libraryHandle }}',
                label: '{{ field.fieldLabel }}',
                {% set libraryHandle = field.fieldSource.first.libraryHandle %}
                {% set library = craft.categories.group(libraryHandle) %}
                {% set selectedEntries = null %}
                {% set floor = 0 %}
                {% set ceil = 0 %}
                {% set values = [] %}
                {% set lastone = null %}

                {% if field.displayType.value in ['simpleslider','stepslider','doubleslider'] %}
                    {% switch libraryHandle %}
                        {% case "sirka" %}
                            {% set selectedEntries = craft.entries.section('polozky').find({(libraryHandle):'> 0'})|supersort('sortas','{sirka}') %}
                            {% for shw in selectedEntries %}
                                {% if loop.first %}{% set floor = shw.sirka %}{% endif %}
                                {% if loop.last %}{% set ceil = shw.sirka %}{% endif %}
                                {% if lastone != shw.sirka %}{% set values = values|merge([shw.sirka]) %}{% endif %}
                                {% set lastone = shw.sirka%}
                            {% endfor %}
                        {% case "vyska" %}
                            {% set selectedEntries = craft.entries.section('polozky').find({(libraryHandle):'> 0'})|supersort('sortas','{vyska}') %}
                            {% for shw in selectedEntries %}
                                {% if loop.first %}{% set floor = shw.vyska %}{% endif %}
                                {% if loop.last %}{% set ceil = shw.vyska %}{% endif %}
                                {% if lastone != shw.vyska %}{% set values = values|merge([shw.vyska]) %}{% endif %}
                                {% set lastone = shw.vyska %}
                            {% endfor %}
                        {% case "vnitrniVyska" %}
                            {% set selectedEntries = craft.entries.section('polozky').find({(libraryHandle):'> 0'})|supersort('sortas','{vnitrniVyska}') %}
                            {% for shw in selectedEntries %}
                                {% if loop.first %}{% set floor = shw.vnitrniVyska %}{% endif %}
                                {% if loop.last %}{% set ceil = shw.vnitrniVyska %}{% endif %}
                                {% if lastone != shw.vnitrniVyska %}{% set values = values|merge([shw.vnitrniVyska]) %}{% endif %}
                                {% set lastone = shw.vnitrniVyska %}
                            {% endfor %}
                        {% case "hloubka" %}
                            {% set selectedEntries = craft.entries.section('polozky').find({(libraryHandle):'> 0'})|supersort('sortas','{hloubka}') %}
                            {% for shw in selectedEntries %}
                                {% if loop.first %}{% set floor = shw.hloubka %}{% endif %}
                                {% if loop.last %}{% set ceil = shw.hloubka %}{% endif %}
                                {% if lastone != shw.hloubka %}{% set values = values|merge([shw.hloubka]) %}{% endif %}
                                {% set lastone = shw.hloubka %}
                            {% endfor %}
                        {% case "hmotnost" %}
                            {% set selectedEntries = craft.entries.section('polozky').find({(libraryHandle):'> 0'})|supersort('sortas','{hmotnost}') %}
                            {% for shw in selectedEntries %}
                                {% if loop.first %}{% set floor = shw.hmotnost %}{% endif %}
                                {% if loop.last %}{% set ceil = shw.hmotnost %}{% endif %}
                                {% if lastone != shw.hmotnost %}{% set values = values|merge([shw.hmotnost]) %}{% endif %}
                                {% set lastone = shw.hmotnost %}
                            {% endfor %}
                        {% case "hmotnostNaPlochu" %}
                            {% set selectedEntries = craft.entries.section('polozky').find({(libraryHandle):'> 0'})|supersort('sortas','{hmotnostNaPlochu}') %}
                            {% for shw in selectedEntries %}
                                {% if loop.first %}{% set floor = shw.hmotnostNaPlochu %}{% endif %}
                                {% if loop.last %}{% set ceil = shw.hmotnostNaPlochu %}{% endif %}
                                {% if lastone != shw.hmotnostNaPlochu %}{% set values = values|merge([shw.hmotnostNaPlochu ]) %}{% endif %}
                                {% set lastone = shw.hmotnostNaPlochu %}
                            {% endfor %}
                        {% default%}
                    {% endswitch %}
                {% endif %}

                {% switch field.displayType %}
                    {% case "dropdown" %}
                        type: 'dropdown',
                        style: {
                            width: 10
                        },
                        value: [],{% include "/_partials/filter/_fieldtype-dropdown.twig" %}
                    {% case "cloud" %}
                        type: 'cloud',
                        style: {
                            width: 10
                        },
                        value: [],{% include "/_partials/filter/_fieldtype-dropdown.twig" %}

                    {# NOTE: pokdu pošlu reálné hodnoty, jak poznám, zda user slider použil nebo ne? #}
                    {% case "simpleslider" %}
                        type: 'slider',
                        value: 10,
                        default: 10,

                        options: { // ruzne pro ruzne typy slider, cloud a dropdown
                            showTicks: true,
                            ceil: {{ ceil }},
                            floor: {{ floor }}
                        },
                    {% case "stepslider" %}
                        type: 'slider',
                        value: 2,
                        default: 2,

                        options: {
                            showTicks: true,
                            stepsArray: [{% for single in values %}{{single}}{% if not loop.last %},{% endif %}{% endfor %}]
                        },
                    {% case "doubleslider" %}
                        type: 'range',
                        min: 10,
                        max: 20,
                        defaultmin: 10,
                        defaultmax: 20,
                        options: {
                            floor: {{ floor }},
                            ceil: {{ ceil }},
                            step: 2,
                            showTicks: true
                        },

                {% endswitch %}

                style: {
                    width: 12
                },

                disabled: [
                    { handle_id: ['handle_id_value', 'handle_id_value', 'handle_id_value'] }
                ]

            },
            {% endfor %}

        ]
    }

    {% endfor %}
];
