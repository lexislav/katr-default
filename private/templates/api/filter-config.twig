{% header "Content-Type: application/json" %}

var FilterConfig = [

    {% for section in craft.categories.group('filter') %}
    {
        type: 'section',
        label: '{{ section.title }}',
        header: {{ section.hasSectionHeader ? 'true':'false' }},
        closable: {{ section.isSectionClosable ? 'true':'false' }},
        opened: {{ section.isSectionOpen ? 'true':'false' }},

        fields: [

            {% for field in section.filter.sectionfield %}

            {
                id: '{{ field.fieldSource.first.libraryHandle }}',
                label: '{{ field.fieldLabel }}',
                {% set libraryHandle = field.fieldSource.first.libraryHandle %}
                {% set library = craft.categories.group(libraryHandle) %}
                {% set selectedEntries = null %}
                {% set floor = 0 %}
                {% set ceil = 0 %}
                {% set values = [] %}
                {% set lastone = null %}
                {% set default = null %}

                {% if field.displayType.value in ['simpleslider','stepslider','doubleslider'] %}
                    {% switch libraryHandle %}
                        {% case "sirka" %}
                            {% set selectedEntries = craft.entries.section('polozky').find({(libraryHandle):'> 0'})|supersort('sortas','{sirka}') %}
                            {% for shw in selectedEntries %}
                                {% if loop.first %}{% set floor = shw.sirka %}{% endif %}
                                {% if loop.last %}{% set ceil = shw.sirka %}{% endif %}
                                {% if lastone != shw.sirka %}{% set values = values|merge([shw.sirka]) %}{% endif %}
                                {% set lastone = shw.sirka%}
                            {% endfor %}
                        {% case "vyska" %}
                            {% set selectedEntries = craft.entries.section('polozky').find({(libraryHandle):'> 0'})|supersort('sortas','{vyska}') %}
                            {# {% set selectedEntries = craft.entries.section('polozky').find({(libraryHandle):'> 0'}).order('vyska') %} #}
                            {% for shw in selectedEntries %}
                                {% if loop.first %}{% set floor = shw.vyska %}{% endif %}
                                {% if loop.last %}{% set ceil = shw.vyska %}{% endif %}
                                {% if lastone != shw.vyska %}{% set values = values|merge([shw.vyska]) %}{% endif %}
                                {% set lastone = shw.vyska %}
                            {% endfor %}
                        {% case "vnitrniVyska" %}
                            {% set selectedEntries = craft.entries.section('polozky').find({(libraryHandle):'> 0'})|supersort('sortas','{vnitrniVyska}') %}
                            {% for shw in selectedEntries %}
                                {% if loop.first %}{% set floor = shw.vnitrniVyska %}{% endif %}
                                {% if loop.last %}{% set ceil = shw.vnitrniVyska %}{% endif %}
                                {% if lastone != shw.vnitrniVyska %}{% set values = values|merge([shw.vnitrniVyska]) %}{% endif %}
                                {% set lastone = shw.vnitrniVyska %}
                            {% endfor %}
                        {% case "hloubka" %}
                            {% set selectedEntries = craft.entries.section('polozky').find({(libraryHandle):'> 0'})|supersort('sortas','{hloubka}') %}
                            {% for shw in selectedEntries %}
                                {% if loop.first %}{% set floor = shw.hloubka %}{% endif %}
                                {% if loop.last %}{% set ceil = shw.hloubka %}{% endif %}
                                {% if lastone != shw.hloubka %}{% set values = values|merge([shw.hloubka]) %}{% endif %}
                                {% set lastone = shw.hloubka %}
                            {% endfor %}
                        {% case "hmotnost" %}
                            {% set selectedEntries = craft.entries.section('polozky').find({(libraryHandle):'> 0'})|supersort('sortas','{hmotnost}') %}
                            {% for shw in selectedEntries %}
                                {% if loop.first %}{% set floor = shw.hmotnost %}{% endif %}
                                {% if loop.last %}{% set ceil = shw.hmotnost %}{% endif %}
                                {% if lastone != shw.hmotnost %}{% set values = values|merge([shw.hmotnost]) %}{% endif %}
                                {% set lastone = shw.hmotnost %}
                            {% endfor %}
                        {% case "hmotnostNaPlochu" %}
                            {% set selectedEntries = craft.entries.section('polozky').find({(libraryHandle):'> 0'})|supersort('sortas','{hmotnostNaPlochu}') %}
                            {% for shw in selectedEntries %}
                                {% if loop.first %}{% set floor = shw.hmotnostNaPlochu %}{% endif %}
                                {% if loop.last %}{% set ceil = shw.hmotnostNaPlochu %}{% endif %}
                                {% if lastone != shw.hmotnostNaPlochu %}{% set values = values|merge([shw.hmotnostNaPlochu ]) %}{% endif %}
                                {% set lastone = shw.hmotnostNaPlochu %}
                            {% endfor %}
                        {% case "tepelnaOdolnost" %}
                            {% set selectedEntries = craft.entries.section('polozky')|supersort('sortas','{tepelnaOdolnost.first}') %}
                            {% for shw in selectedEntries %}
                                {% if shw.tepelnaOdolnost.first %}
                                    {% if loop.first %}{% set floor = shw.tepelnaOdolnost.first %}{% endif %}
                                    {% if loop.last %}{% set ceil = shw.tepelnaOdolnost.first %}{% endif %}
                                    {% if lastone != shw.tepelnaOdolnost.first.title %}{% set values = values|merge([shw.tepelnaOdolnost.first.title]) %}{% endif %}
                                    {% set lastone = shw.tepelnaOdolnost.first.title %}
                                {% endif %}
                            {% endfor %}
                        {% default %}
                    {% endswitch %}
                {% endif %}

                {% set default = values|length / 2 |round %}

                {% switch field.displayType %}
                    {% case "dropdown" %}
                        type: 'dropdown',
                        value: [],{% include "/_partials/filter/_fieldtype-dropdown.twig" %}
                    {% case "cloud" %}
                        type: 'cloud',
                        value: [],{% include "/_partials/filter/_fieldtype-dropdown.twig" %}

                    {# NOTE: pokdu pošlu reálné hodnoty, jak poznám, zda user slider použil nebo ne? #}
                    {% case "simpleslider" %}
                        type: 'slider',
                        value: 10,
                        default: {{default}},

                        options: { // ruzne pro ruzne typy slider, cloud a dropdown
                            showTicks: true,
                            ceil: {{ ceil }},
                            floor: {{ floor }}
                        },
                    {% case "stepslider" %}
                        type: 'slider',
                        value: 2,
                        default: {{default}},

                        options: {
                            showTicks: true,
                            stepsArray: [{% for single in values %}{{single}}{% if not loop.last %},{% endif %}{% endfor %}]
                        },
                    {% case "doubleslider" %}
                        type: 'range',
                        min: {{floor}},
                        max: {{ceil}},
                        defaultmin: 0,
                        defaultmax: 0,
                        options: {
                            floor: {{ floor }},
                            ceil: {{ ceil }},
                            step: 2,
                            showTicks: true
                        },

                {% endswitch %}
                {# NOTE: Pokud je label políčka prázdný, rovnou se mu dá 0 šířka. Pokud není prázdný, šířka popisku se vztahuje k celkové šířce pole#}
                style: {
                    width: {{field.fieldSize}},
                    {% if field.fieldLabel == '' %}
                        widthLabel: 0
                    {% elseif field.fieldSize == '12' %}
                        widthLabel: 1
                    {% else %}
                        widthLabel: 2
                    {% endif %}
                },

                disabled: [
                    { handle_id: ['handle_id_value', 'handle_id_value', 'handle_id_value'] }
                ]

            }{% if not loop.last %},{% endif %}
            {% endfor %}

        ]
    }{% if not loop.last %},{% endif %}

    {% endfor %}
];
